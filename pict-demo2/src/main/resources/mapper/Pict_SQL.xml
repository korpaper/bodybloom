<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pict.mapper.PictMapper">
	
	<!-- 스케쥴관리 -->
	<select id="schedule_list" resultType="pictVO">
        SELECT s.*, e.impossible, e.possible, e.etc, e.regdate
        FROM schedule_table s
        left outer join etc_table e on e.idx = s.etcidx
        WHERE 1=1
        <if test="userid != null and userid != '' ">
             AND s.userid = #{userid}
        </if>
        ORDER BY CAST(targettime AS UNSIGNED), CAST(targetday AS UNSIGNED)
	</select>


	<select id="schedule_list_one" resultType="pictVO">
		select *
		from schedule_table
		where idx = #{idx}
	</select>
	
	<insert id="schedule_insert" parameterType="pictVO">
		INSERT INTO schedule_table
			(
                userid, targetdate, targettime, title
			)
		VALUES (
			 #{userid}, #{targetdate}, #{targettime}, #{title}
			  ) 
	</insert>
	
	<update id="schedule_update" parameterType="pictVO">
		update schedule_table
		set userid =#{userid}, title = #{title}, moddate = now(), etcidx = #{etcidx}
		where idx = #{idx}
	</update>
	
	<delete id="schedule_delete" parameterType="pictVO">
		delete from schedule_table where idx = #{idx}
	</delete>

    <select id="selectScheduleCount" resultType="int">
        SELECT COUNT(*)
        FROM schedule_table
        WHERE targetdate = #{targetdate}
        AND targettime = #{targettime}
        AND userid = #{userid}
    </select>





    <!-- 오늘의 운동법 -->
    <select id="today_list" resultType="pictVO">
        select *
        from video_table
        <if test="search_text != null and search_text != '' ">
            where (
            title LIKE CONCAT('%', #{search_text}, '%')
            )
        </if>
    </select>

    <select id="today_list_one" resultType="pictVO">
        select *
        from video_table
        where idx = #{idx}
    </select>

    <insert id="today_insert" parameterType="pictVO">
        INSERT INTO video_table
        (
            title, imgurl, videourl, regdate, text
        )
        VALUES (
           #{title}, #{imgurl}, #{videourl}, now(), #{text}
        )
    </insert>

    <update id="today_update" parameterType="pictVO">
        update video_table
        set title =#{title}, videourl = #{videourl}, text = #{text}
        <if test="imgurl != null and imgurl != '' ">
            , imgurl = #{imgurl}
        </if>
        where idx = #{idx}
    </update>

    <delete id="today_delete" parameterType="pictVO">
        delete from video_table where idx = #{idx}
    </delete>


    <!-- 후기 관리 -->
    <select id="review_list" resultType="pictVO">
        select idx, name, title, text
        from review_table
        <if test="search_text != null and search_text != '' ">
            where (
            title LIKE CONCAT('%', #{search_text}, '%') or
            text LIKE CONCAT('%', #{search_text}, '%')
            )
        </if>
    </select>

    <select id="review_list_one" resultType="pictVO">
        select idx, name, title, text
        from review_table
        where idx = #{idx}
    </select>

    <insert id="review_insert" parameterType="pictVO">
        INSERT INTO review_table
        (
            name, title, text
        )
        VALUES (
           #{name}, #{title}, #{text}
        )
    </insert>

    <update id="review_update" parameterType="pictVO">
        update review_table
        set name =#{name}, title = #{title}, text = #{text}
        where idx = #{idx}
    </update>

    <delete id="review_delete" parameterType="pictVO">
        delete from review_table where idx = #{idx}
    </delete>



    <!-- 팝업 관리 -->
    <select id="popup_list" resultType="pictVO">
        select *
        from popup_table
        <if test="search_text != null and search_text != '' ">
            where (
            title LIKE CONCAT('%', #{search_text}, '%')
            )
        </if>
    </select>

    <select id="popup_list_one" resultType="pictVO">
        select *
        from popup_table
        where idx = #{idx}
    </select>

    <insert id="popup_insert" parameterType="pictVO">
        INSERT INTO popup_table
        (
            title, imgurl, linkurl, regdate
        )
        VALUES (
                   #{title}, #{imgurl}, #{linkurl}, now()
               )
    </insert>

    <update id="popup_update" parameterType="pictVO">
        update popup_table
        set title =#{title}, linkurl = #{linkurl}
        <if test="imgurl != null and imgurl != '' ">
            , imgurl = #{imgurl}
        </if>
        where idx = #{idx}
    </update>

    <delete id="popup_delete" parameterType="pictVO">
        delete from popup_table where idx = #{idx}
    </delete>


    <insert id="user_insert" parameterType="adminVO">
        INSERT INTO user_info
        (
            id, password, name, mobile, reg_date, use_at
        )
        VALUES (
           #{id}, #{password}, #{name}, #{mobile}, now(), 'Y'
       )
    </insert>


    <insert id="schedule_etc_insert" parameterType="pictVO" useGeneratedKeys="true" keyProperty="etcidx" keyColumn="idx">
        INSERT INTO etc_table
        (
            impossible, possible, etc, regdate
        )
        VALUES (
           #{impossible}, #{possible}, #{etc}, now()
       )
    </insert>

    <update id="schedule_etc_update" parameterType="pictVO">
        update etc_table
        set impossible =#{impossible}, possible = #{possible}, etc =#{etc}
        where idx = #{etcidx}
    </update>

</mapper>
